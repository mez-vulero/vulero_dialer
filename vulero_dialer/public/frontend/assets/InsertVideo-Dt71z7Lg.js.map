{"version":3,"file":"InsertVideo-Dt71z7Lg.js","sources":["../../../../frontend/node_modules/frappe-ui/src/utils/fileUploadHandler.ts","../../../../frontend/node_modules/frappe-ui/src/components/FileUploader.vue","../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/InsertVideo.vue"],"sourcesContent":["interface UploadOptions {\n  private?: boolean\n  folder?: string\n  file_url?: string\n  doctype?: string\n  docname?: string\n  fieldname?: string\n  method?: string\n  type?: string\n  upload_endpoint?: string\n}\n\ntype EventListenerOption = 'start' | 'progress' | 'finish' | 'error'\n\ndeclare global {\n  interface Window {\n    csrf_token?: string\n  }\n}\n\nclass FileUploadHandler {\n  listeners: { [event: string]: Function[] }\n  failed: boolean\n\n  constructor() {\n    this.listeners = {}\n    this.failed = false\n  }\n\n  on(event: EventListenerOption, handler: Function) {\n    this.listeners[event] = this.listeners[event] || []\n    this.listeners[event].push(handler)\n  }\n\n  trigger(event: string, data?: any) {\n    let handlers = this.listeners[event] || []\n    handlers.forEach((handler) => {\n      handler.call(this, data)\n    })\n  }\n\n  upload(file: File | null, options: UploadOptions): Promise<any> {\n    return new Promise((resolve, reject) => {\n      let xhr = new XMLHttpRequest()\n      xhr.upload.addEventListener('loadstart', () => {\n        this.trigger('start')\n      })\n      xhr.upload.addEventListener('progress', (e) => {\n        if (e.lengthComputable) {\n          this.trigger('progress', {\n            uploaded: e.loaded,\n            total: e.total,\n          })\n        }\n      })\n      xhr.upload.addEventListener('load', () => {\n        this.trigger('finish')\n      })\n      xhr.addEventListener('error', () => {\n        this.trigger('error')\n        reject()\n      })\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState == XMLHttpRequest.DONE) {\n          let error\n          if (xhr.status === 200) {\n            let r = null\n            try {\n              r = JSON.parse(xhr.responseText)\n            } catch (e) {\n              r = xhr.responseText\n            }\n            let out = r.message || r\n            resolve(out)\n          } else if (xhr.status === 403) {\n            error = JSON.parse(xhr.responseText)\n          } else {\n            this.failed = true\n            try {\n              error = JSON.parse(xhr.responseText)\n            } catch (e) {\n              // pass\n            }\n          }\n          if (error && error.exc) {\n            console.error(JSON.parse(error.exc)[0])\n          }\n          reject(error)\n        }\n      }\n\n      const uploadEndpoint =\n        options.upload_endpoint || '/api/method/upload_file'\n      xhr.open('POST', uploadEndpoint, true)\n      xhr.setRequestHeader('Accept', 'application/json')\n\n      if (window.csrf_token && window.csrf_token !== '{{ csrf_token }}') {\n        xhr.setRequestHeader('X-Frappe-CSRF-Token', window.csrf_token)\n      }\n\n      let form_data = new FormData()\n      if (file) {\n        form_data.append('file', file, file.name)\n      }\n      form_data.append('is_private', options.private || false ? '1' : '0')\n      form_data.append('folder', options.folder || 'Home')\n\n      if (options.file_url) {\n        form_data.append('file_url', options.file_url)\n      }\n\n      if (options.doctype) {\n        form_data.append('doctype', options.doctype)\n      }\n\n      if (options.docname) {\n        form_data.append('docname', options.docname)\n      }\n\n      if (options.fieldname) {\n        form_data.append('fieldname', options.fieldname)\n      }\n\n      if (options.method) {\n        form_data.append('method', options.method)\n      }\n\n      if (options.type) {\n        form_data.append('type', options.type)\n      }\n\n      xhr.send(form_data)\n    })\n  }\n}\n\nexport default FileUploadHandler\n","<template>\n  <div>\n    <input\n      ref=\"input\"\n      type=\"file\"\n      :accept=\"fileTypes\"\n      class=\"hidden\"\n      @change=\"onFileAdd\"\n    />\n    <slot\n      v-bind=\"{\n        file,\n        uploading,\n        progress,\n        uploaded,\n        message,\n        error,\n        total,\n        success,\n        openFileSelector,\n      }\"\n    />\n  </div>\n</template>\n\n<script>\nimport FileUploadHandler from '../utils/fileUploadHandler'\n\nexport default {\n  name: 'FileUploader',\n  props: ['fileTypes', 'uploadArgs', 'validateFile'],\n  data() {\n    return {\n      uploader: null,\n      uploading: false,\n      uploaded: 0,\n      error: null,\n      message: '',\n      total: 0,\n      file: null,\n      finishedUploading: false,\n    }\n  },\n  computed: {\n    progress() {\n      let value = Math.floor((this.uploaded / this.total) * 100)\n      return isNaN(value) ? 0 : value\n    },\n    success() {\n      return this.finishedUploading && !this.error\n    },\n  },\n  methods: {\n    openFileSelector() {\n      this.$refs['input'].click()\n    },\n    async onFileAdd(e) {\n      this.error = null\n      this.file = e.target.files[0]\n\n      if (this.file && this.validateFile) {\n        try {\n          let message = await this.validateFile(this.file)\n          if (message) {\n            this.error = message\n          }\n        } catch (error) {\n          this.error = error\n        }\n      }\n\n      if (!this.error) {\n        this.uploadFile(this.file)\n      }\n    },\n    async uploadFile(file) {\n      this.error = null\n      this.uploaded = 0\n      this.total = 0\n\n      this.uploader = new FileUploadHandler()\n      this.uploader.on('start', () => {\n        this.uploading = true\n      })\n      this.uploader.on('progress', (data) => {\n        this.uploaded = data.uploaded\n        this.total = data.total\n      })\n      this.uploader.on('error', () => {\n        this.uploading = false\n        this.error = 'Error Uploading File'\n      })\n      this.uploader.on('finish', () => {\n        this.uploading = false\n        this.finishedUploading = true\n      })\n      this.uploader\n        .upload(file, this.uploadArgs || {})\n        .then((data) => {\n          this.$emit('success', data)\n        })\n        .catch((error) => {\n          this.uploading = false\n          let errorMessage = 'Error Uploading File'\n          if (error?._server_messages) {\n            errorMessage = JSON.parse(\n              JSON.parse(error._server_messages)[0]\n            ).message\n          } else if (error?.exc) {\n            errorMessage = JSON.parse(error.exc)[0].split('\\n').slice(-2, -1)[0]\n          }\n          this.error = errorMessage\n          this.$emit('failure', error)\n        })\n    },\n  },\n}\n</script>\n","<template>\n  <slot v-bind=\"{ onClick: openDialog }\"></slot>\n  <Dialog\n    :options=\"{ title: 'Add Video' }\"\n    v-model=\"addVideoDialog.show\"\n    @after-leave=\"reset\"\n  >\n    <template #body-content>\n      <FileUploader\n        file-types=\"video/*\"\n        @success=\"(file) => (addVideoDialog.url = file.file_url)\"\n      >\n        <template v-slot=\"{ file, progress, uploading, openFileSelector }\">\n          <div class=\"flex items-center space-x-2\">\n            <Button @click=\"openFileSelector\">\n              {{\n                uploading\n                  ? `Uploading ${progress}%`\n                  : addVideoDialog.url\n                  ? 'Change Video'\n                  : 'Upload Video'\n              }}\n            </Button>\n            <Button\n              v-if=\"addVideoDialog.url\"\n              @click=\"\n                () => {\n                  addVideoDialog.url = null\n                  addVideoDialog.file = null\n                }\n              \"\n            >\n              Remove\n            </Button>\n          </div>\n        </template>\n      </FileUploader>\n      <video\n        v-if=\"addVideoDialog.url\"\n        :src=\"addVideoDialog.url\"\n        class=\"mt-2 w-full rounded-lg\"\n        type=\"video/mp4\"\n        controls\n      />\n    </template>\n    <template #actions>\n      <Button variant=\"solid\" @click=\"addVideo(addVideoDialog.url)\">\n        Insert Video\n      </Button>\n      <Button @click=\"reset\">Cancel</Button>\n    </template>\n  </Dialog>\n</template>\n<script>\nimport Button from '../Button.vue'\nimport Dialog from '../Dialog.vue'\nimport FileUploader from '../FileUploader.vue'\n\nexport default {\n  name: 'InsertImage',\n  props: ['editor'],\n  expose: ['openDialog'],\n  data() {\n    return {\n      addVideoDialog: { url: '', file: null, show: false },\n    }\n  },\n  components: { Button, Dialog, FileUploader },\n  methods: {\n    openDialog() {\n      this.addVideoDialog.show = true\n    },\n    onVideoSelect(e) {\n      let file = e.target.files[0]\n      if (!file) {\n        return\n      }\n      this.addVideoDialog.file = file\n    },\n\n    addVideo(src) {\n      this.editor\n        .chain()\n        .focus()\n        .insertContent(`<video src=\"${src}\"></video>`)\n        .run()\n      this.reset()\n    },\n    reset() {\n      this.addVideoDialog = this.$options.data().addVideoDialog\n    },\n  },\n}\n</script>\n"],"names":["FileUploadHandler","event","handler","data","file","options","resolve","reject","xhr","e","error","r","out","uploadEndpoint","form_data","_sfc_main","value","__async","message","errorMessage","_hoisted_1","_createElementBlock","_createElementVNode","$props","$options","args","_renderSlot","_ctx","_normalizeProps","_guardReactiveProps","$data","Button","Dialog","FileUploader","src","_hoisted_2","_openBlock","_Fragment","_createVNode","_component_Dialog","_cache","$event","_component_FileUploader","_withCtx","progress","uploading","openFileSelector","_component_Button","_createTextVNode","_toDisplayString","_createBlock","_createCommentVNode"],"mappings":"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","x_google_ignoreList":[0,1,2]}